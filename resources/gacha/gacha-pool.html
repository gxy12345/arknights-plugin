{{extend defaultLayout}}

{{block 'css'}}
<link rel="stylesheet" type="text/css" href="{{pluResPath}}gacha/gacha.css">
<style>
    .stats-card {
        display: none;
    }
    
    .pity-card {
        display: none;
    }
</style>
{{/block}}

{{block 'main'}}
<div class="gacha-body">
    <div class="gacha-container">
        <div class="header">
            <div class="avatar-section">
                <div class="avatar-wrapper">
                    <img src="{{status.avatar.url}}" class="avatar" />
                </div>
                <div class="user-info">
                    <h1 class="nickname">{{character.nickname}}</h1>
                    <div class="badges">
                        <div class="server-badge">
                            <span class="server-text">{{if character.channel_master_id === '1'}}官服{{else}}B服{{/if}}</span>
                        </div>
                        <div class="level-badge">
                            <span class="level-text">LV.{{status.level}}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        {{each record.pools pool}}
        <div class="pool-card">
            <div class="pool-header">
                <div class="pool-info">
                    <span class="pool-name">{{pool.gachaPoolName}}</span>
                    {{if pool.up_six_chars && pool.up_six_chars.length > 0}}
                    <div class="up-chars">
                        {{each pool.up_six_chars charId}}
                        <img src="https://web.hycdn.cn/arknights/game/assets/char_skin/avatar/{{charId}}%231.png" class="char-avatar" />
                        {{/each}}
                    </div>
                    {{/if}}
                </div>
                <div class="pool-total">
                    {{pool.poolTotalPulls}}<span class="unit-sm">抽</span>
                </div>
            </div>
            <div class="pool-content">
                {{each pool.records rec}}
                {{each rec.pulls pull}}
                {{if pull.rarity === 5}}
                <div class="pull-item">
                    <div class="pull-char">
                        <img src="https://web.hycdn.cn/arknights/game/assets/char_skin/avatar/{{pull.char_id}}%231.png" class="pull-avatar" />
                        <div class="pull-date">{{rec.gacha_ts_str}}</div>
                    </div>
                    <div class="pull-info">
                        <div class="pull-bar-wrapper">
                            {{if pull.pity_count >= 60}}
                            <div class="pull-bar red-bar" style="width: {{Math.min(10 + pull.pity_count, 110)}}%">
                                <span class="pull-count">{{pull.pity_count}} 抽</span>
                            </div>
                            {{else if pull.pity_count >= 35}}
                            <div class="pull-bar yellow-bar" style="width: {{Math.min(10 + pull.pity_count, 110)}}%">
                                <span class="pull-count">{{pull.pity_count}} 抽</span>
                            </div>
                            {{else}}
                            <div class="pull-bar green-bar" style="width: {{Math.min(10 + pull.pity_count, 110)}}%">
                                <span class="pull-count">{{pull.pity_count}} 抽</span>
                            </div>
                            {{/if}}
                            {{if pull.pity_count <= 10}}
                            <div class="luck-badge lucky">
                                <span>超欧</span>
                            </div>
                            {{else if pull.pity_count >= 60}}
                            <div class="luck-badge unlucky">
                                <span>超非</span>
                            </div>
                            {{/if}}
                            {{if pull.is_off_banner}}
                            <div class="luck-badge off-banner">
                                <span>歪</span>
                            </div>
                            {{/if}}
                        </div>
                        {{if pull.five_stars_list && pull.five_stars_list.length > 0}}
                        <div class="five-stars">
                            {{each pull.five_stars_list fsCharId}}
                            <img src="https://web.hycdn.cn/arknights/game/assets/char_skin/avatar/{{fsCharId}}%231.png" class="five-star-avatar" />
                            {{/each}}
                        </div>
                        {{/if}}
                    </div>
                </div>
                {{/if}}
                {{/each}}
                {{/each}}
            </div>
        </div>
        {{/each}}

        <div class="logo">
            {{@sys.createdby}}
        </div>
    </div>
</div>
{{/block}}
